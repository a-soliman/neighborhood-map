"use strict";var map=void 0,infoWindow=void 0,markers=[],backupLocations=[{name:"The Trident",position:{lat:37.853405,lng:-122.478708},image:"https://s3-media3.fl.yelpcdn.com/bphoto/SavnswRo8GIvK1nKc-boyA/o.jpg",rating:3.5,address:"558 Bridgeway",highlighted:ko.observable(!1)},{name:"Napa Valley Burger Company",position:{lat:37.854616,lng:-122.479051},image:"https://s3-media2.fl.yelpcdn.com/bphoto/c4qNa-lDiZkMWRCirX1lgA/o.jpg",rating:4,address:"670 Bridgeway",highlighted:ko.observable(!1)},{name:"Barrel House Tavern",position:{lat:37.855221,lng:-122.478831},image:"https://s3-media3.fl.yelpcdn.com/bphoto/ndYSXvbqcxIthPof8nNbow/o.jpg",rating:3.5,address:"660 Bridgeway",highlighted:ko.observable(!1)},{name:"Lighthouse Cafe",position:{lat:37.856413,lng:-122.480081},image:"https://s3-media4.fl.yelpcdn.com/bphoto/rx9px8mrxgCFKU0img12MA/o.jpg",rating:4,address:"1311 Bridgeway",highlighted:ko.observable(!1)},{name:"Seafood Peddler",position:{lat:37.856567,lng:-122.478235},image:"https://s3-media1.fl.yelpcdn.com/bphoto/p6xdlY3vpG-G7WeGAFYOyA/o.jpg",rating:3.5,address:"303 Johnson St",highlighted:ko.observable(!1)}];function AppViewModel(){var t=this;t.spinner=ko.observable(!1),t.locations=ko.observableArray(),t.filteredLocations=ko.observableArray(),t.filterString=ko.observable(""),t.dataLoadError=ko.observable(!1),t.signalHighlited=function(o){for(var e=o.name,n=0;n<t.locations().length;n++){var a=t.locations()[n];if(a.name==e){a.highlighted(!0);var i=markers.filter(function(o){return o.name==e})[0];i&&(t.animateBouncing(i),t.displayInfoWindow(i))}else a.highlighted(!1)}},t.animateBouncing=function(e){markers.forEach(function(o){o==e?o.setAnimation(google.maps.Animation.BOUNCE):o.setAnimation(null)})},t.displayInfoWindow=function(o){infoWindow.setContent('\n            <div class="infoWindow">\n                <h3 class="name">'+o.name+'</h3>\n                <h4 class="rating">Yelp Rating: '+o.rating+"</h4>\n                <p>"+o.address+'</p>\n                <img src="'+o.image+'">\n            </div>\n            '),infoWindow.open(map,o)},t.search=function(){var e=t.filterString();if(0<e.length){var o=t.locations().filter(function(o){return o.name.toLowerCase().includes(e)});t.filteredLocations(o)}else t.filteredLocations([]);t.filterMarkers(e)},t.filterMarkers=function(e){var o=markers.filter(function(o){return-1==o.name.toLowerCase().indexOf(e)}),n=markers.filter(function(o){return-1!=o.name.toLowerCase().indexOf(e)});o.forEach(function(o){o.setMap(null)}),n.forEach(function(o){o.setMap(map)})},t.toggleNav=function(){var o=$(".list-container"),e=$(".toggle-icon");o.toggle(),o.is(":visible")?e.removeClass("fa-arrow-right").addClass("fa-arrow-left"):e.removeClass("fa-arrow-left").addClass("fa-arrow-right")}}var viewModel=new AppViewModel;function initMap(){var o=document.getElementById("map");map=new google.maps.Map(o,{center:{lat:37.855221,lng:-122.478831},zoom:14,mapTypeId:"roadmap"}),viewModel.locations().forEach(function(o,e){var n=new google.maps.Marker({position:o.position,map:map,name:o.name,image:o.image,rating:o.rating,address:o.address,id:e});infoWindow=new google.maps.InfoWindow,n.addListener("click",function(){infoWindow.setContent('\n            <div class="infoWindow">\n                <h3 class="name">'+n.name+'</h3>\n                <h4 class="rating">Yelp Rating: '+n.rating+"</h4>\n                <p>"+n.address+'</p>\n                <img src="'+n.image+'">\n            </div>\n            '),infoWindow.open(map,n),viewModel.signalHighlited(n)}),markers.push(n)})}function getLocationsFromYelp(){fetch("http://localhost:3333").then(function(o){200===o.status?o.json().then(function(o){o.forEach(function(o){o.highlighted=ko.observable(!1)}),viewModel.locations(o),viewModel.dataLoadError(!1),initMap()}):o.json().then(function(o){console.log("check the backend"),viewModel.locations(backupLocations),initMap()})}).catch(function(o){console.log("Fetch Error :-S",o),viewModel.locations(backupLocations),viewModel.dataLoadError(!0),alert("Error has occurred while loading data, results will be limited.."),initMap()})}function raiseGAPIError(){alert("Error loading GMaps API script.")}getLocationsFromYelp(),ko.applyBindings(viewModel);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsibWFwIiwiaW5mb1dpbmRvdyIsIm1hcmtlcnMiLCJiYWNrdXBMb2NhdGlvbnMiLCJuYW1lIiwibGF0IiwibG5nIiwicG9zaXRpb24iLCJpbWFnZSIsInJhdGluZyIsImFkZHJlc3MiLCJrbyIsIm9ic2VydmFibGUiLCJoaWdobGlnaHRlZCIsIkFwcFZpZXdNb2RlbCIsInNlbGYiLCJmaWx0ZXJlZExvY2F0aW9ucyIsInNwaW5uZXIiLCJkYXRhTG9hZEVycm9yIiwib2JzZXJ2YWJsZUFycmF5Iiwic2lnbmFsSGlnaGxpdGVkIiwiZGF0YSIsImkiLCJsb2NhdGlvbnMiLCJsb2NhdGlvbiIsImxlbmd0aCIsIm1hcmtlciIsImRpc3BsYXlJbmZvV2luZG93IiwiaXRlbSIsImFuaW1hdGVCb3VuY2luZyIsImdpdmVuTWFya2VyIiwic2V0QW5pbWF0aW9uIiwiZ29vZ2xlIiwibWFwcyIsIkFuaW1hdGlvbiIsIkJPVU5DRSIsInNlYXJjaCIsInZhbHVlIiwiZmlsdGVyU3RyaW5nIiwibWFya2Vyc1RvSGlkZSIsInJlc3VsdCIsImZpbHRlciIsImluZGV4T2YiLCJ0b0xvd2VyQ2FzZSIsImluY2x1ZGVzIiwiZmlsdGVyTWFya2VycyIsIm5hdkNvbnRhaW5lciIsInRvZ2dsZUljb24iLCIkIiwicmVtb3ZlQ2xhc3MiLCJzZXRNYXAiLCJ2aWV3TW9kZWwiLCJ0b2dnbGUiLCJtYXBDb250YWluZXIiLCJkb2N1bWVudCIsIm1hcE9wdGlvbnMiLCJhZGRDbGFzcyIsIm1hcFR5cGVJZCIsInNldENvbnRlbnQiLCJjZW50ZXIiLCJ6b29tIiwiZm9yRWFjaCIsIk1hcmtlciIsImdldExvY2F0aW9uc0Zyb21ZZWxwIiwicmVzcG9uc2UiLCJpbml0TWFwIiwiYWRkTGlzdGVuZXIiLCJvcGVuIiwiZmV0Y2giLCJyYWlzZUdBUElFcnJvciIsImFsZXJ0Iiwic3RhdHVzIiwianNvbiIsInRoZW4iLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ci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R0FDVCxNQUFBQSxFQUFBTyxPQXBCV1AsRUFBU1EsT0FBT0MsS0FBSyxTQUFTcEQsR0FDMUJBLEVBQUt3QyxRQUFRLFNBQUVqQyxHQUNYQSxFQUFLZixZQUFjRixHQUFHQyxZQUFXLEtBRXJDdUMsVUFBVTVCLFVBQVVGLEdBQ3BCOEIsVUFBVWpDLGVBQWMsR0FDeEIrQyxZQWRBRCxFQUFTUSxPQUFPQyxLQUFNLFNBQUVwRCxHQThCeEMwQyxRQUFBQSxJQUFBQSxxQkE1Qm9CWixVQUFVNUIsVUFBVXBCLGlCQStCdkJnRCxjQWhCUnVCLE1BQU8sU0FBVUMsR0FDZEMsUUFBUUMsSUFBSSxrQkFBbUJGLEdBQy9CeEIsVUFBVTVCLFVBQVVwQixpQkFDcEJnRCxVQUFVakMsZUFBYyxHQUN4Qm9ELE1BQU0sb0VBQ05MLFlBSVosU0FBU0ksaUJBQ0xDLE1BQU0sbUNBR1ZQLHVCQUdBcEQsR0FBR21FLGNBQWMzQiIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogR0xPQkFMIFZBUklBQkxFUyAqL1xyXG5sZXQgbWFwO1xyXG5sZXQgaW5mb1dpbmRvdztcclxuY29uc3QgbWFya2VycyA9IFtdO1xyXG5jb25zdCBiYWNrdXBMb2NhdGlvbnMgPSBbXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogJ1RoZSBUcmlkZW50JyxcclxuICAgICAgICBwb3NpdGlvbjoge2xhdDogMzcuODUzNDA1LCBsbmc6IC0xMjIuNDc4NzA4fSxcclxuICAgICAgICBpbWFnZTogJ2h0dHBzOi8vczMtbWVkaWEzLmZsLnllbHBjZG4uY29tL2JwaG90by9TYXZuc3dSbzhHSXZLMW5LYy1ib3lBL28uanBnJyxcclxuICAgICAgICByYXRpbmc6IDMuNSxcclxuICAgICAgICBhZGRyZXNzOiAnNTU4IEJyaWRnZXdheScsXHJcbiAgICAgICAgaGlnaGxpZ2h0ZWQ6IGtvLm9ic2VydmFibGUoZmFsc2UpXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6ICdOYXBhIFZhbGxleSBCdXJnZXIgQ29tcGFueScsXHJcbiAgICAgICAgcG9zaXRpb246IHtsYXQ6IDM3Ljg1NDYxNiwgbG5nOiAtMTIyLjQ3OTA1MX0sXHJcbiAgICAgICAgaW1hZ2U6ICdodHRwczovL3MzLW1lZGlhMi5mbC55ZWxwY2RuLmNvbS9icGhvdG8vYzRxTmEtbERpWmtNV1JDaXJYMWxnQS9vLmpwZycsXHJcbiAgICAgICAgcmF0aW5nOiA0LFxyXG4gICAgICAgIGFkZHJlc3M6ICc2NzAgQnJpZGdld2F5JyxcclxuICAgICAgICBoaWdobGlnaHRlZDoga28ub2JzZXJ2YWJsZShmYWxzZSlcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogJ0JhcnJlbCBIb3VzZSBUYXZlcm4nLFxyXG4gICAgICAgIHBvc2l0aW9uOiB7bGF0OiAzNy44NTUyMjEsIGxuZzogLTEyMi40Nzg4MzF9LFxyXG4gICAgICAgIGltYWdlOiAnaHR0cHM6Ly9zMy1tZWRpYTMuZmwueWVscGNkbi5jb20vYnBob3RvL25kWVNYdmJxY3hJdGhQb2Y4bk5ib3cvby5qcGcnLFxyXG4gICAgICAgIHJhdGluZzogMy41LFxyXG4gICAgICAgIGFkZHJlc3M6ICc2NjAgQnJpZGdld2F5JyxcclxuICAgICAgICBoaWdobGlnaHRlZDoga28ub2JzZXJ2YWJsZShmYWxzZSlcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbmFtZTogJ0xpZ2h0aG91c2UgQ2FmZScsXHJcbiAgICAgICAgcG9zaXRpb246IHtsYXQ6IDM3Ljg1NjQxMywgbG5nOiAtMTIyLjQ4MDA4MX0sXHJcbiAgICAgICAgaW1hZ2U6ICdodHRwczovL3MzLW1lZGlhNC5mbC55ZWxwY2RuLmNvbS9icGhvdG8vcng5cHg4bXJ4Z0NGS1UwaW1nMTJNQS9vLmpwZycsXHJcbiAgICAgICAgcmF0aW5nOiA0LFxyXG4gICAgICAgIGFkZHJlc3M6ICcxMzExIEJyaWRnZXdheScsXHJcbiAgICAgICAgaGlnaGxpZ2h0ZWQ6IGtvLm9ic2VydmFibGUoZmFsc2UpXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICAgIG5hbWU6ICdTZWFmb29kIFBlZGRsZXInLFxyXG4gICAgICAgIHBvc2l0aW9uOiB7bGF0OiAzNy44NTY1NjcsIGxuZzogLTEyMi40NzgyMzV9LFxyXG4gICAgICAgIGltYWdlOiAnaHR0cHM6Ly9zMy1tZWRpYTEuZmwueWVscGNkbi5jb20vYnBob3RvL3A2eGRsWTN2cEctRzdXZUdBRllPeUEvby5qcGcnLFxyXG4gICAgICAgIHJhdGluZzogMy41LFxyXG4gICAgICAgIGFkZHJlc3M6ICczMDMgSm9obnNvbiBTdCcsXHJcbiAgICAgICAgaGlnaGxpZ2h0ZWQ6IGtvLm9ic2VydmFibGUoZmFsc2UpXHJcbiAgICB9XHJcbl07XHJcblxyXG5cclxuLyogS08gKi9cclxuZnVuY3Rpb24gQXBwVmlld01vZGVsKCkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgc2VsZi5zcGlubmVyID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7XHJcbiAgICBzZWxmLmxvY2F0aW9ucyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xyXG5cclxuICAgIHNlbGYuZmlsdGVyZWRMb2NhdGlvbnMgPSBrby5vYnNlcnZhYmxlQXJyYXkoKTtcclxuICAgIHNlbGYuZmlsdGVyU3RyaW5nID0ga28ub2JzZXJ2YWJsZSgnJyk7XHJcblxyXG4gICAgc2VsZi5kYXRhTG9hZEVycm9yID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7XHJcblxyXG4gICAgLyogU0lOR0FMIEhJR0hMSUdIVCBTVEFURSBUTyBUSEUgVklFV01PREVMICovXHJcbiAgICBzZWxmLnNpZ25hbEhpZ2hsaXRlZCA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgbGV0IG5hbWUgPSBkYXRhLm5hbWU7XHJcbiAgICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgc2VsZi5sb2NhdGlvbnMoKS5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICAgICAgbGV0IGxvY2F0aW9uID0gc2VsZi5sb2NhdGlvbnMoKVtpXTtcclxuICAgICAgICBcclxuICAgICAgICAgICAgaWYgKCBsb2NhdGlvbi5uYW1lID09IG5hbWUgKSB7XHJcbiAgICAgICAgICAgICAgICBsb2NhdGlvbi5oaWdobGlnaHRlZCh0cnVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbWFya2VyID0gbWFya2Vycy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0ubmFtZSA9PSBuYW1lKVswXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIG1hcmtlciApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hbmltYXRlQm91bmNpbmcobWFya2VyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kaXNwbGF5SW5mb1dpbmRvdyhtYXJrZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsb2NhdGlvbi5oaWdobGlnaHRlZChmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8qICBTRVQgQk9VTlNJTkcgQU5JTUFUSU9OIE9OIE1BUktFUiAqL1xyXG4gICAgc2VsZi5hbmltYXRlQm91bmNpbmcgPSBmdW5jdGlvbiAoZ2l2ZW5NYXJrZXIpIHtcclxuICAgICAgICBtYXJrZXJzLmZvckVhY2goKCBtYXJrZXIgKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICggbWFya2VyID09IGdpdmVuTWFya2VyICkge1xyXG4gICAgICAgICAgICAgICAgbWFya2VyLnNldEFuaW1hdGlvbihnb29nbGUubWFwcy5BbmltYXRpb24uQk9VTkNFKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG1hcmtlci5zZXRBbmltYXRpb24obnVsbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgLyogRElTUExBWVMgQU4gSU5GT1dJTkRPVyBJRiBBIFJFU1RBVVJBTlQgSVMgSElHSExJR0hURUQgKi9cclxuICAgIHNlbGYuZGlzcGxheUluZm9XaW5kb3cgPSBmdW5jdGlvbihtYXJrZXIpIHtcclxuICAgICAgICBpbmZvV2luZG93LnNldENvbnRlbnQoIGBcclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImluZm9XaW5kb3dcIj5cclxuICAgICAgICAgICAgICAgIDxoMyBjbGFzcz1cIm5hbWVcIj4ke21hcmtlci5uYW1lfTwvaDM+XHJcbiAgICAgICAgICAgICAgICA8aDQgY2xhc3M9XCJyYXRpbmdcIj5ZZWxwIFJhdGluZzogJHttYXJrZXIucmF0aW5nfTwvaDQ+XHJcbiAgICAgICAgICAgICAgICA8cD4ke21hcmtlci5hZGRyZXNzfTwvcD5cclxuICAgICAgICAgICAgICAgIDxpbWcgc3JjPVwiJHttYXJrZXIuaW1hZ2V9XCI+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICBgKTtcclxuICAgICAgICAgICAgaW5mb1dpbmRvdy5vcGVuKG1hcCwgbWFya2VyKTtcclxuICAgIH07XHJcblxyXG4gICAgc2VsZi5zZWFyY2ggPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBsZXQgdmFsdWUgPSBzZWxmLmZpbHRlclN0cmluZygpO1xyXG5cclxuICAgICAgICBpZiAoIHZhbHVlLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSBzZWxmLmxvY2F0aW9ucygpLmZpbHRlcigoIGxvY2F0aW9uICkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxvY2F0aW9uLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBzZWxmLmZpbHRlcmVkTG9jYXRpb25zKHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzZWxmLmZpbHRlcmVkTG9jYXRpb25zKFtdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZi5maWx0ZXJNYXJrZXJzKHZhbHVlKTtcclxuICAgIH07XHJcblxyXG4gICAgc2VsZi5maWx0ZXJNYXJrZXJzID0gZnVuY3Rpb24oIHZhbHVlICkge1xyXG4gICAgICAgIGxldCBtYXJrZXJzVG9IaWRlID0gbWFya2Vycy5maWx0ZXIoKCBtYXJrZXIgKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBtYXJrZXIubmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodmFsdWUpID09IC0xO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGxldCBtYXJrZXJzVG9EaXNwbGF5ID0gbWFya2Vycy5maWx0ZXIoKCBtYXJrZXIgKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBtYXJrZXIubmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodmFsdWUpICE9IC0xO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIG1hcmtlcnNUb0hpZGUuZm9yRWFjaCgoIG1hcmtlciApID0+IHtcclxuICAgICAgICAgICAgbWFya2VyLnNldE1hcChudWxsKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBtYXJrZXJzVG9EaXNwbGF5LmZvckVhY2goKCBtYXJrZXIgKSA9PiB7XHJcbiAgICAgICAgICAgIG1hcmtlci5zZXRNYXAobWFwKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgc2VsZi50b2dnbGVOYXYgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBsZXQgbmF2Q29udGFpbmVyID0gJCgnLmxpc3QtY29udGFpbmVyJyk7XHJcbiAgICAgICAgbGV0IHRvZ2dsZUljb24gPSAkKCcudG9nZ2xlLWljb24nKTtcclxuXHJcbiAgICAgICAgbmF2Q29udGFpbmVyLnRvZ2dsZSgpO1xyXG4gICAgICAgIGlmICggbmF2Q29udGFpbmVyLmlzKFwiOnZpc2libGVcIikpIHtcclxuICAgICAgICAgICAgdG9nZ2xlSWNvbi5yZW1vdmVDbGFzcygnZmEtYXJyb3ctcmlnaHQnKS5hZGRDbGFzcygnZmEtYXJyb3ctbGVmdCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdG9nZ2xlSWNvbi5yZW1vdmVDbGFzcygnZmEtYXJyb3ctbGVmdCcpLmFkZENsYXNzKCdmYS1hcnJvdy1yaWdodCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuXHJcbiAgICB9O1xyXG5cclxuXHJcbn1cclxuXHJcbmxldCB2aWV3TW9kZWwgPSBuZXcgQXBwVmlld01vZGVsKCk7XHJcblxyXG4vKiBJTklUSUFMSVpJTkcgVEhFIE1BUCAqL1xyXG5mdW5jdGlvbiBpbml0TWFwKCkge1xyXG4gICAgLy8gR0VUIFRIRSBNQVAgQ09OVEFJTkVSIEFORCBTRVQgVEhFIE9QVElPTlNcclxuICAgIGNvbnN0IG1hcENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKTtcclxuICAgIGNvbnN0IG1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgY2VudGVyOiB7bGF0OiAzNy44NTUyMjEsIGxuZzogLTEyMi40Nzg4MzF9LFxyXG4gICAgICAgIHpvb206IDE0LFxyXG4gICAgICAgIG1hcFR5cGVJZDogJ3JvYWRtYXAnXHJcbiAgICB9O1xyXG5cclxuICAgIC8vSU5JVElBTElaRSBUSEUgTUFQXHJcbiAgICBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKG1hcENvbnRhaW5lciwgbWFwT3B0aW9ucyk7XHJcblxyXG4gICAgLyogTE9PUCBUTyBDUkVBVEUgTUFSS0VSIFBFUiBFQUNIIExPQ0FUSU9OICovXHJcbiAgICB2aWV3TW9kZWwubG9jYXRpb25zKCkuZm9yRWFjaCgoIGxvY2F0aW9uLCBpICkgPT4ge1xyXG4gICAgICAgIGxldCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgcG9zaXRpb246IGxvY2F0aW9uLnBvc2l0aW9uLFxyXG4gICAgICAgICAgICBtYXA6IG1hcCxcclxuICAgICAgICAgICAgbmFtZTogbG9jYXRpb24ubmFtZSxcclxuICAgICAgICAgICAgaW1hZ2U6IGxvY2F0aW9uLmltYWdlLFxyXG4gICAgICAgICAgICByYXRpbmc6IGxvY2F0aW9uLnJhdGluZyxcclxuICAgICAgICAgICAgYWRkcmVzczogbG9jYXRpb24uYWRkcmVzcyxcclxuICAgICAgICAgICAgaWQ6IGlcclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGluZm9XaW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdygpO1xyXG5cclxuICAgICAgICBtYXJrZXIuYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGluZm9XaW5kb3cuc2V0Q29udGVudCggYFxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaW5mb1dpbmRvd1wiPlxyXG4gICAgICAgICAgICAgICAgPGgzIGNsYXNzPVwibmFtZVwiPiR7bWFya2VyLm5hbWV9PC9oMz5cclxuICAgICAgICAgICAgICAgIDxoNCBjbGFzcz1cInJhdGluZ1wiPlllbHAgUmF0aW5nOiAke21hcmtlci5yYXRpbmd9PC9oND5cclxuICAgICAgICAgICAgICAgIDxwPiR7bWFya2VyLmFkZHJlc3N9PC9wPlxyXG4gICAgICAgICAgICAgICAgPGltZyBzcmM9XCIke21hcmtlci5pbWFnZX1cIj5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgIGApO1xyXG4gICAgICAgICAgICBpbmZvV2luZG93Lm9wZW4obWFwLCBtYXJrZXIpO1xyXG4gICAgICAgICAgICB2aWV3TW9kZWwuc2lnbmFsSGlnaGxpdGVkKG1hcmtlcik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIG1hcmtlcnMucHVzaChtYXJrZXIpO1xyXG4gICAgfSk7XHJcblxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRMb2NhdGlvbnNGcm9tWWVscCgpIHtcclxuICAgIGZldGNoKCdodHRwOi8vbG9jYWxob3N0OjMzMzMnKVxyXG4gICAgICAgIC50aGVuKCBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDAgKSB7XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZS5qc29uKCkudGhlbiggKCBkYXRhICkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjaGVjayB0aGUgYmFja2VuZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5sb2NhdGlvbnMoYmFja3VwTG9jYXRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICBpbml0TWFwKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzcG9uc2UuanNvbigpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgZGF0YS5mb3JFYWNoKCggaXRlbSApID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLmhpZ2hsaWdodGVkID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5sb2NhdGlvbnMoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB2aWV3TW9kZWwuZGF0YUxvYWRFcnJvcihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBpbml0TWFwKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKCBmdW5jdGlvbiggZXJyICkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRmV0Y2ggRXJyb3IgOi1TJywgZXJyKTtcclxuICAgICAgICAgICAgdmlld01vZGVsLmxvY2F0aW9ucyhiYWNrdXBMb2NhdGlvbnMpO1xyXG4gICAgICAgICAgICB2aWV3TW9kZWwuZGF0YUxvYWRFcnJvcih0cnVlKTtcclxuICAgICAgICAgICAgYWxlcnQoJ0Vycm9yIGhhcyBvY2N1cnJlZCB3aGlsZSBsb2FkaW5nIGRhdGEsIHJlc3VsdHMgd2lsbCBiZSBsaW1pdGVkLi4nKTtcclxuICAgICAgICAgICAgaW5pdE1hcCgpO1xyXG4gICAgICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiByYWlzZUdBUElFcnJvcigpIHtcclxuICAgIGFsZXJ0KCdFcnJvciBsb2FkaW5nIEdNYXBzIEFQSSBzY3JpcHQuJyk7XHJcbn1cclxuXHJcbmdldExvY2F0aW9uc0Zyb21ZZWxwKCk7XHJcblxyXG5cclxua28uYXBwbHlCaW5kaW5ncyh2aWV3TW9kZWwpOyJdfQ==
